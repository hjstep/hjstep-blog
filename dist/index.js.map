{"version":3,"file":"index.js","sources":["../render.js","../components/posts.js","../router.js","../components/detail.js","../model/state.js","../index.js","../components/app.js"],"sourcesContent":["\n\nconst vdom = {};\nconst addComponent = (name, component) => {\n  vdom[name] = component;\n};\nconst removeComponent = (name, root)  => {\n    vdom[name] = undefined;\n    root.querySelector(`[data-component=\"${name}\"]`).innerHTML = '';\n};\n\nconst render = async (element, dispatch, redirect, name) => {\n    console.log(vdom);\n  const cloneComponent = !name\n    ? element.cloneNode(true)\n    : await vdom[name](element, dispatch, redirect);\n  const childComponents = cloneComponent.querySelectorAll(\"[data-component]\");\n\n  [...childComponents].forEach(async (childNode) => {\n    const { component: name } = childNode.dataset;\n    if (vdom[name] !== undefined) {\n      const newChildNode = await render(childNode, dispatch, redirect, name);\n      childNode.replaceWith(newChildNode);\n    }\n  });\n\n  return cloneComponent;\n};\n\nconst renderDOM = (rootElement, dispatch, redirect) => {\n    window.requestAnimationFrame(async () => {\n     console.log(\"원본 rootElement >>>> \", rootElement);\n     const newRootElement = await render(rootElement, dispatch, redirect);\n     console.log(\"교체 newRootElement >>>>>>>>>>>>>>>  \", newRootElement);\n    rootElement.replaceWith(newRootElement);\n  });\n};\n\nexport { renderDOM, addComponent, removeComponent };\n","const createPostsNode = () => {\n  const template = document.getElementById(\"template-post\");\n  return template.content.firstElementChild.cloneNode(true);\n};\n\nconst getTemplate = ({ attributes }, index) => {\n\n  const element = createPostsNode();\n\n  element.querySelector(\".post\").dataset.index = index + 1;\n  element.querySelector(\".title\").textContent = attributes.title;\n  element.querySelector(\".summary\").textContent = attributes.summary;\n  element.querySelector(\".date\").textContent = attributes.date.slice(0, 10);\n  return element;\n};\n\nexport default async (element, dispatch, redirect) => {\n  const posts = await dispatch(\"posts\");\n\n  const newElement = element.cloneNode(true);\n  posts\n    .map((post, index) => getTemplate(post, index))\n    .forEach((node) => newElement.appendChild(node));\n\n\n  newElement.addEventListener(\"click\", (e) => {\n    const $post = e.target.closest(\"article.post\");\n\n    if ($post) {\n      const id = $post.getAttribute(\"data-index\");\n      redirect(`/posts/${id}`);\n    }\n  });\n\n  return newElement;\n};\n","const ROUTE_PARAMETER_REGEXP = /:(\\w+)/g;\r\nconst URL_FRAGMENT_REGEXP = \"([^\\\\/]+)\";\r\nimport { renderDOM } from \"./render.js\";\r\n\r\nconst extractUrlParams = (route, windowHash) => {\r\n  const params = {};\r\n\r\n  if (route.params.length === 0) {\r\n    return params;\r\n  }\r\n\r\n  const matches = windowHash.match(route.testRegExp);\r\n\r\n  matches.shift();\r\n\r\n  matches.forEach((paramValue, index) => {\r\n    const paramName = route.params[index];\r\n    params[paramName] = paramValue;\r\n  });\r\n\r\n  return params;\r\n};\r\n\r\nexport default () => {\r\n  const routes = [];\r\n  let notFound = () => {};\r\n\r\n  const router = {};\r\n\r\n  const checkRoutes = (dispatch, redirect) => {\r\n    const { hash } = window.location;\r\n\r\n    const currentRoute = routes.find((route) => {\r\n      const { testRegExp } = route;\r\n      return testRegExp.test(hash);\r\n    });\r\n\r\n    if (!currentRoute) {\r\n      notFound();\r\n      return;\r\n    }\r\n\r\n    const urlParams = extractUrlParams(currentRoute, window.location.hash);\r\nconst root = document.getElementById(\"root\");\r\n    currentRoute.component(root, urlParams);\r\n    \r\n\r\n    renderDOM(root, dispatch, redirect);\r\n  };\r\n\r\n  // fragment에서 매개변수 이름 추출\r\n  router.addRoute = (fragment, component) => {\r\n    const params = [];\r\n\r\n    const parsedFragment = fragment\r\n      .replace(ROUTE_PARAMETER_REGEXP, (match, paramName) => {\r\n        params.push(paramName);\r\n        return URL_FRAGMENT_REGEXP;\r\n      })\r\n      .replace(/\\//g, \"\\\\/\");\r\n\r\n    routes.push({\r\n      testRegExp: new RegExp(`^${parsedFragment}$`),\r\n      component,\r\n      params,\r\n    });\r\n\r\n    return router;\r\n  };\r\n\r\n  router.setNotFound = (cb) => {\r\n    notFound = cb;\r\n    return router;\r\n  };\r\n\r\n  router.navigate = (fragment) => {\r\n    window.location.hash = fragment;\r\n  };\r\n\r\n  router.start = (dispatch, redirect) => {\r\n    window.addEventListener(\"hashchange\", () => {\r\n      console.log(\"hash changed !\");\r\n      checkRoutes(dispatch, redirect);\r\n    });\r\n    if (!window.location.hash) {\r\n      window.location.hash = \"#/posts\";\r\n    }\r\n\r\n    checkRoutes(dispatch, redirect);\r\n  };\r\n\r\n  return router;\r\n};\r\n","const createDetailNode = () => {\n  const template = document.getElementById(\"template-detail\");\n  return template.content.firstElementChild.cloneNode(true);\n};\n\nexport default async (id, element, dispatch) => {\n  const posts = await dispatch(\"posts\");\n  const { attributes, htmlBody } = posts[Number(id) - 1];\n\n  //document.querySelector(\"[data-component=posts]\").innerHTML = \"\";\n\n  const detailElement = createDetailNode();\n  detailElement.querySelector(\".markdown-body\").innerHTML = htmlBody;\n  detailElement.querySelector(\".title\").textContent = attributes.title;\n  detailElement.querySelector(\".date\").textContent = attributes.date.slice(\n    0,\n    10\n  );\n  const newElement = element.cloneNode(true);\n  newElement.appendChild(detailElement);\n  return newElement;\n};\n","import { stat } from \"fs\";\n\nconst state = {\n  posts: [],\n  isPending: true,\n};\n\nconst fetchPosts = async () => {\n  try {\n    if (!state.isPending) return;\n    const response = await fetch(\"./data/react.json\");\n\n    if (!response.ok) {\n      throw new Error(\"Failed to fetch JSON file\");\n    }\n\n    const { posts } = await response.json();\n\n    state.posts = posts;\n    state.isPending = false;\n  } catch (error) {\n    console.error(\"Error fetching JSON file:\", error);\n  }\n};\n\nexport default async (key) => {\n  try {\n    await fetchPosts();\n    if (state[key] === undefined) {\n      throw new Error(\"undefined key\");\n    }\n    return state[key];\n  } catch (error) {\n    console.error(\"Error load state:\", error);\n  }\n};\n","import { addComponent, removeComponent, renderDOM } from \"./render.js\";\nimport appComponent from \"./components/app.js\";\nimport postsComponent from \"./components/posts.js\";\nimport createRouter from \"./router.js\";\nimport detailComponent from \"./components/detail.js\";\nimport model from \"./model/state.js\";\nimport \"./css/index.css\";\nimport \"./css/layout.css\";\nimport \"./css/header.css\";\nimport \"./css/post.css\";\nimport \"./css/detail.css\";\n\nconst dispatch = async (key) => await model(key);\n\nconst redirect = (path) => {\n  window.location.hash = path;\n};\n\naddComponent(\"app\", appComponent);\n\nconst router = createRouter();\nrouter\n  .addRoute(\"#/posts\", (root) => {\n    addComponent(\"posts\", postsComponent);\n    removeComponent(\"detail\", root);\n  })\n  .addRoute(\"#/posts/:id\", (root, { id }) => {\n    addComponent(\"detail\", (...args) => detailComponent(id, ...args));\n    removeComponent(\"posts\", root);\n  })\n  .setNotFound(() => (document.getElementById(\"root\").innerHTML = \"Not found\"))\n  .start(dispatch, redirect);\n\nconst NAV_BTN_SELECTOR = \"a[data-navigation]\";\ndocument.body.addEventListener(\"click\", (e) => {\n  const { target } = e;\n  if (target.matches(NAV_BTN_SELECTOR)) {\n    const { navigate } = target.dataset;\n    router.navigate(navigate);\n  }\n});\n","const getTemplate = () => {\n  const template = document.getElementById(\"template-header\");\n  return template.content.firstElementChild.cloneNode(true);\n};\n\nexport default (element) => {\n  const newElement = element.cloneNode(true);\n  newElement.innerHTML = \"\";\n  newElement.appendChild(getTemplate());\n\n  return newElement;\n};\n"],"names":["vdom","addComponent","name","component","removeComponent","root","undefined","querySelector","innerHTML","render","async","element","dispatch","redirect","console","log","cloneComponent","cloneNode","querySelectorAll","forEach","childNode","dataset","newChildNode","replaceWith","getTemplate","attributes","index","document","getElementById","content","firstElementChild","textContent","title","summary","date","slice","postsComponent","posts","newElement","map","post","node","appendChild","addEventListener","e","$post","target","closest","id","getAttribute","ROUTE_PARAMETER_REGEXP","detailComponent","htmlBody","Number","detailElement","state","isPending","model","key","response","fetch","ok","Error","json","error","fetchPosts","router","routes","notFound","checkRoutes","hash","window","location","currentRoute","find","route","testRegExp","test","urlParams","windowHash","params","length","matches","match","shift","paramValue","paramName","extractUrlParams","rootElement","requestAnimationFrame","newRootElement","renderDOM","addRoute","fragment","parsedFragment","replace","push","RegExp","setNotFound","cb","navigate","start","createRouter","args","path","body"],"mappings":"yBAEA,MAAMA,EAAO,CAAA,EACPC,EAAe,CAACC,EAAMC,KAC1BH,EAAKE,GAAQC,CAAS,EAElBC,EAAkB,CAACF,EAAMG,KAC3BL,EAAKE,QAAQI,EACbD,EAAKE,cAAc,oBAAoBL,OAAUM,UAAY,EAAE,EAG7DC,EAASC,MAAOC,EAASC,EAAUC,EAAUX,KAC/CY,QAAQC,IAAIf,GACd,MAAMgB,EAAkBd,QAEdF,EAAKE,GAAMS,EAASC,EAAUC,GADpCF,EAAQM,WAAU,GAYtB,MARA,IAFwBD,EAAeE,iBAAiB,qBAEnCC,SAAQT,MAAOU,IAClC,MAAQjB,UAAWD,GAASkB,EAAUC,QACtC,QAAmBf,IAAfN,EAAKE,GAAqB,CAC5B,MAAMoB,QAAqBb,EAAOW,EAAWR,EAAUC,EAAUX,GACjEkB,EAAUG,YAAYD,EACvB,KAGIN,CAAc,EC1BvB,MAKMQ,EAAc,EAAGC,cAAcC,KAEnC,MAAMf,EANWgB,SAASC,eAAe,iBACzBC,QAAQC,kBAAkBb,WAAU,GAWpD,OAJAN,EAAQJ,cAAc,SAASc,QAAQK,MAAQA,EAAQ,EACvDf,EAAQJ,cAAc,UAAUwB,YAAcN,EAAWO,MACzDrB,EAAQJ,cAAc,YAAYwB,YAAcN,EAAWQ,QAC3DtB,EAAQJ,cAAc,SAASwB,YAAcN,EAAWS,KAAKC,MAAM,EAAG,IAC/DxB,CAAO,EAGhB,IAAAyB,EAAe1B,MAAOC,EAASC,EAAUC,KACvC,MAAMwB,QAAczB,EAAS,SAEvB0B,EAAa3B,EAAQM,WAAU,GAerC,OAdAoB,EACGE,KAAI,CAACC,EAAMd,IAAUF,EAAYgB,EAAMd,KACvCP,SAASsB,GAASH,EAAWI,YAAYD,KAG5CH,EAAWK,iBAAiB,SAAUC,IACpC,MAAMC,EAAQD,EAAEE,OAAOC,QAAQ,gBAE/B,GAAIF,EAAO,CACT,MAAMG,EAAKH,EAAMI,aAAa,cAC9BpC,EAAS,UAAUmC,IACpB,KAGIV,CAAU,EClCnB,MAAMY,EAAyB,UCK/B,IAAAC,EAAezC,MAAOsC,EAAIrC,EAASC,KACjC,MAAMyB,QAAczB,EAAS,UACvBa,WAAEA,EAAU2B,SAAEA,GAAaf,EAAMgB,OAAOL,GAAM,GAI9CM,EAVW3B,SAASC,eAAe,mBACzBC,QAAQC,kBAAkBb,WAAU,GAUpDqC,EAAc/C,cAAc,kBAAkBC,UAAY4C,EAC1DE,EAAc/C,cAAc,UAAUwB,YAAcN,EAAWO,MAC/DsB,EAAc/C,cAAc,SAASwB,YAAcN,EAAWS,KAAKC,MACjE,EACA,IAEF,MAAMG,EAAa3B,EAAQM,WAAU,GAErC,OADAqB,EAAWI,YAAYY,GAChBhB,CAAU,EClBnB,MAAMiB,EAAQ,CACZlB,MAAO,GACPmB,WAAW,GAqBE,IAAAC,EAAA/C,MAAOgD,IACpB,IAEE,QArBehD,WACjB,IACE,IAAK6C,EAAMC,UAAW,OACtB,MAAMG,QAAiBC,MAAM,qBAE7B,IAAKD,EAASE,GACZ,MAAM,IAAIC,MAAM,6BAGlB,MAAMzB,MAAEA,SAAgBsB,EAASI,OAEjCR,EAAMlB,MAAQA,EACdkB,EAAMC,WAAY,CACnB,CAAC,MAAOQ,GACPlD,QAAQkD,MAAM,4BAA6BA,EAC5C,GAKOC,QACa3D,IAAfiD,EAAMG,GACR,MAAM,IAAII,MAAM,iBAElB,OAAOP,EAAMG,EACd,CAAC,MAAOM,GACPlD,QAAQkD,MAAM,oBAAqBA,EACpC,GChBH/D,EAAa,OCbGU,IACd,MAAM2B,EAAa3B,EAAQM,WAAU,GAIrC,OAHAqB,EAAW9B,UAAY,GACvB8B,EAAWI,YAPMf,SAASC,eAAe,mBACzBC,QAAQC,kBAAkBb,WAAU,IAQ7CqB,CAAU,IDUnB,MAAM4B,EHGS,MACb,MAAMC,EAAS,GACf,IAAIC,EAAW,OAEf,MAAMF,EAAS,CAAA,EAETG,EAAc,CAACzD,EAAUC,KAC7B,MAAMyD,KAAEA,GAASC,OAAOC,SAElBC,EAAeN,EAAOO,MAAMC,IAChC,MAAMC,WAAEA,GAAeD,EACvB,OAAOC,EAAWC,KAAKP,EAAK,IAG9B,IAAKG,EAEH,YADAL,IAIF,MAAMU,EAtCe,EAACH,EAAOI,KAC/B,MAAMC,EAAS,CAAA,EAEf,GAA4B,IAAxBL,EAAMK,OAAOC,OACf,OAAOD,EAGT,MAAME,EAAUH,EAAWI,MAAMR,EAAMC,YASvC,OAPAM,EAAQE,QAERF,EAAQ/D,SAAQ,CAACkE,EAAY3D,KAC3B,MAAM4D,EAAYX,EAAMK,OAAOtD,GAC/BsD,EAAOM,GAAaD,CAAU,IAGzBL,CAAM,EAsBOO,CAAiBd,EAAcF,OAAOC,SAASF,MAC/DjE,EAAOsB,SAASC,eAAe,QACjC6C,EAAatE,UAAUE,EAAMyE,GFff,EAACU,EAAa5E,EAAUC,KACtC0D,OAAOkB,uBAAsB/E,UAC5BI,QAAQC,IAAI,uBAAwByE,GACpC,MAAME,QAAuBjF,EAAO+E,EAAa5E,EAAUC,GAC3DC,QAAQC,IAAI,sCAAuC2E,GACpDF,EAAYjE,YAAYmE,EAAe,GACvC,EEYAC,CAAUtF,EAAMO,EAAUC,EAAS,EA4CrC,OAxCAqD,EAAO0B,SAAW,CAACC,EAAU1F,KAC3B,MAAM6E,EAAS,GAETc,EAAiBD,EACpBE,QAAQ7C,GAAwB,CAACiC,EAAOG,KACvCN,EAAOgB,KAAKV,GAvDQ,eA0DrBS,QAAQ,MAAO,OAQlB,OANA5B,EAAO6B,KAAK,CACVpB,WAAY,IAAIqB,OAAO,IAAIH,MAC3B3F,YACA6E,WAGKd,CAAM,EAGfA,EAAOgC,YAAeC,IACpB/B,EAAW+B,EACJjC,GAGTA,EAAOkC,SAAYP,IACjBtB,OAAOC,SAASF,KAAOuB,CAAQ,EAGjC3B,EAAOmC,MAAQ,CAACzF,EAAUC,KACxB0D,OAAO5B,iBAAiB,cAAc,KACpC7B,QAAQC,IAAI,kBACZsD,EAAYzD,EAAUC,EAAS,IAE5B0D,OAAOC,SAASF,OACnBC,OAAOC,SAASF,KAAO,WAGzBD,EAAYzD,EAAUC,EAAS,EAG1BqD,CAAM,EGvEAoC,GACfpC,EACG0B,SAAS,WAAYvF,IACpBJ,EAAa,QAASmC,GACtBhC,EAAgB,SAAUC,EAAK,IAEhCuF,SAAS,eAAe,CAACvF,GAAQ2C,SAChC/C,EAAa,UAAU,IAAIsG,IAASpD,EAAgBH,KAAOuD,KAC3DnG,EAAgB,QAASC,EAAK,IAE/B6F,aAAY,IAAOvE,SAASC,eAAe,QAAQpB,UAAY,cAC/D6F,OAnBc3F,MAAOgD,SAAcD,EAAMC,KAE1B8C,IAChBjC,OAAOC,SAASF,KAAOkC,CAAI,IAmB7B7E,SAAS8E,KAAK9D,iBAAiB,SAAUC,IACvC,MAAME,OAAEA,GAAWF,EACnB,GAAIE,EAAOoC,QAHY,sBAGe,CACpC,MAAMkB,SAAEA,GAAatD,EAAOzB,QAC5B6C,EAAOkC,SAASA,EACjB"}