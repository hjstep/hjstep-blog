{"version":3,"file":"index.js","sources":["../render.js","../components/page404.js","../components/posts.js","../router.js","../components/detail.js","../model/state.js","../index.js","../components/app.js"],"sourcesContent":["\n\nconst vdom = {};\nconst addComponent = (name, component) => {\n  vdom[name] = component;\n};\nconst removeComponent = (name, root)  => {\n    vdom[name] = undefined;\n  if (root.querySelector(`[data-component=\"${name}\"]`)) {\n    root.querySelector(`[data-component=\"${name}\"]`).innerHTML = '';\n  }\n};\n\nconst render = async (element, dispatch, redirect, name) => {\n    console.log(vdom);\n  const cloneComponent = !name\n    ? element.cloneNode(true)\n    : await vdom[name](element, dispatch, redirect);\n  const childComponents = cloneComponent.querySelectorAll(\"[data-component]\");\n\n  [...childComponents].forEach(async (childNode) => {\n    const { component: name } = childNode.dataset;\n    if (vdom[name] !== undefined) {\n      const newChildNode = await render(childNode, dispatch, redirect, name);\n      childNode.replaceWith(newChildNode);\n    }\n  });\n\n  return cloneComponent;\n};\n\nconst renderDOM = (rootElement, dispatch, redirect) => {\n    window.requestAnimationFrame(async () => {\n     console.log(\"원본 rootElement >>>> \", rootElement);\n     const newRootElement = await render(rootElement, dispatch, redirect);\n     console.log(\"교체 newRootElement >>>>>>>>>>>>>>>  \", newRootElement);\n    rootElement.replaceWith(newRootElement);\n  });\n};\n\nexport { renderDOM, addComponent, removeComponent };\n","const getTemplate = () => {\n  const template = document.getElementById(\"template-404\");\n  return template.content.firstElementChild.cloneNode(true);\n};\n\nexport default () => {\n  const root = document.getElementById(\"root\");\n  const newElement = root.querySelector('[data-component=\"404\"]').cloneNode(true);\n  root.querySelector('[data-component=\"app\"]').innerHTML = '';\n  root.querySelector('[data-component=\"detail\"]').innerHTML = '';\n  root.querySelector('[data-component=\"posts\"]').innerHTML = '';\n  newElement.innerHTML = \"\";\n  newElement.appendChild(getTemplate());\n\n  root.querySelector('[data-component=\"404\"]').replaceWith(newElement);\n};\n","const createPostsNode = () => {\n  const template = document.getElementById(\"template-post\");\n  return template.content.firstElementChild.cloneNode(true);\n};\n\nconst getTemplate = ({ attributes }, index) => {\n\n  const element = createPostsNode();\n\n  console.log(attributes)\n\n  attributes.tag.forEach(tag => {\n    element.querySelector(\".tag\").innerHTML += `<label><mark>#${tag}</mark></label>`\n  })\n\n  element.querySelector(\".post\").dataset.index = index + 1;\n  element.querySelector(\".title\").textContent = attributes.title;\n  element.querySelector(\".summary\").textContent = attributes.summary;\n  element.querySelector(\".date\").textContent = attributes.date.slice(0, 10);\n  return element;\n};\n\nexport default async (element, dispatch, redirect) => {\n  const posts = await dispatch(\"posts\");\n\n  const newElement = element.cloneNode(true);\n    newElement.innerHTML = '';\n  posts\n    .map((post, index) => getTemplate(post, index))\n    .forEach((node) => newElement.appendChild(node));\n\n\n  newElement.addEventListener(\"click\", (e) => {\n    const $post = e.target.closest(\"article.post\");\n\n    if ($post) {\n      const id = $post.getAttribute(\"data-index\");\n      redirect(`/posts/${id}`);\n    }\n  });\n\n  return newElement;\n};\n","const ROUTE_PARAMETER_REGEXP = /:(\\w+)/g;\r\nconst URL_FRAGMENT_REGEXP = \"([^\\\\/]+)\";\r\nimport { renderDOM } from \"./render.js\";\r\n\r\nconst extractUrlParams = (route, windowHash) => {\r\n  const params = {};\r\n\r\n  if (route.params.length === 0) {\r\n    return params;\r\n  }\r\n\r\n  const matches = windowHash.match(route.testRegExp);\r\n\r\n  matches.shift();\r\n\r\n  matches.forEach((paramValue, index) => {\r\n    const paramName = route.params[index];\r\n    params[paramName] = paramValue;\r\n  });\r\n\r\n  return params;\r\n};\r\n\r\nexport default () => {\r\n  const routes = [];\r\n  let notFound = () => {};\r\n  let prevHash = null;\r\n  const router = {};\r\n\r\n  const checkRoutes = (dispatch, redirect) => {\r\n    const { hash } = window.location;\r\n    if (prevHash === hash) {\r\n      return;\r\n    }\r\n\r\n    prevHash = hash;\r\n\r\n    const root = document.getElementById(\"root\");\r\n    const currentRoute = routes.find((route) => {\r\n      const { testRegExp } = route;\r\n      return testRegExp.test(hash);\r\n    });\r\n\r\n    if (!currentRoute) {\r\n      notFound();\r\n      return;\r\n    }\r\n\r\n    const urlParams = extractUrlParams(currentRoute, window.location.hash);\r\n\r\n    currentRoute.component(root, urlParams);\r\n    \r\n\r\n    renderDOM(root, dispatch, redirect);\r\n  };\r\n\r\n  // fragment에서 매개변수 이름 추출\r\n  router.addRoute = (fragment, component) => {\r\n    const params = [];\r\n\r\n    const parsedFragment = fragment\r\n      .replace(ROUTE_PARAMETER_REGEXP, (match, paramName) => {\r\n        params.push(paramName);\r\n        return URL_FRAGMENT_REGEXP;\r\n      })\r\n      .replace(/\\//g, \"\\\\/\");\r\n\r\n    routes.push({\r\n      testRegExp: new RegExp(`^${parsedFragment}$`),\r\n      component,\r\n      params,\r\n    });\r\n\r\n    return router;\r\n  };\r\n\r\n  router.setNotFound = (cb) => {\r\n    notFound = cb;\r\n    return router;\r\n  };\r\n\r\n  router.navigate = (fragment) => {\r\n    window.location.hash = fragment;\r\n  };\r\n\r\n  router.start = (dispatch, redirect) => {\r\n    window.addEventListener(\"hashchange\", () => {\r\n      console.log(\"hash changed !\");\r\n      checkRoutes(dispatch, redirect);\r\n    });\r\n    if (!window.location.hash) {\r\n      window.location.hash = \"#/posts\";\r\n    }\r\n\r\n    checkRoutes(dispatch, redirect);\r\n  };\r\n\r\n  return router;\r\n};\r\n","const NOT_FOUND_POST = {\n  attributes: {\n    title: '존재하지않는 포스트입니다.'\n  },\n  htmlBody: ''\n}\nconst createDetailNode = () => {\n  const template = document.getElementById(\"template-detail\");\n  return template.content.firstElementChild.cloneNode(true);\n};\n\nexport default async (id, element, dispatch) => {\n  const posts = await dispatch(\"posts\");\n  const extractedPost = posts[Number(id) - 1];\n  const { attributes, htmlBody } = extractedPost || NOT_FOUND_POST\n  //document.querySelector(\"[data-component=posts]\").innerHTML = \"\";\n\n  const detailElement = createDetailNode();\n  detailElement.querySelector(\".markdown-body\").innerHTML = htmlBody;\n  detailElement.querySelector(\".title\").textContent = attributes.title;\n  detailElement.querySelector(\".date\").textContent = attributes.date?.slice(\n    0,\n    10\n  );\n  const newElement = element.cloneNode(true);\n  newElement.innerHTML = '';\n  newElement.appendChild(detailElement);\n  return newElement;\n};\n","const state = {\n  posts: [],\n  isPending: true,\n};\n\nconst fetchPosts = async () => {\n  try {\n    if (!state.isPending) return;\n    const response = await fetch(\"./data/react.json\");\n\n    if (!response.ok) {\n      throw new Error(\"Failed to fetch JSON file\");\n    }\n\n    const { posts } = await response.json();\n\n    state.posts = posts;\n    state.isPending = false;\n  } catch (error) {\n    console.error(\"Error fetching JSON file:\", error);\n  }\n};\n\nexport default async (key) => {\n  try {\n    await fetchPosts();\n    if (state[key] === undefined) {\n      throw new Error(\"undefined key\");\n    }\n    return state[key];\n  } catch (error) {\n    console.error(\"Error load state:\", error);\n  }\n};\n","import { addComponent, removeComponent } from \"./render.js\";\nimport appComponent from \"./components/app.js\";\nimport notfoundComponent from \"./components/page404.js\"\nimport postsComponent from \"./components/posts.js\";\nimport createRouter from \"./router.js\";\nimport detailComponent from \"./components/detail.js\";\nimport model from \"./model/state.js\";\nimport \"./css/index.css\";\nimport \"./css/layout.css\";\nimport \"./css/header.css\";\nimport \"./css/post.css\";\nimport \"./css/detail.css\";\n\nconst dispatch = async (key) => await model(key);\n\nconst redirect = (path) => {\n  window.location.hash = path;\n};\n\naddComponent(\"app\", appComponent);\n\nconst router = createRouter();\nrouter\n  .addRoute(\"#/posts\", (root) => {\n    addComponent(\"posts\", postsComponent);\n    removeComponent(\"detail\", root);\n    removeComponent(\"404\", root);\n  })\n  .addRoute(\"#/posts/:id\", (root, { id }) => {\n    addComponent(\"detail\", (...args) => detailComponent(id, ...args));\n    removeComponent(\"posts\", root);\n    removeComponent(\"404\", root);\n  })\n  .setNotFound(() => {\n    notfoundComponent();\n  })\n  .start(dispatch, redirect);\n\nconst NAV_BTN_SELECTOR = \"a[data-navigation]\";\ndocument.body.addEventListener(\"click\", (e) => {\n  const { target } = e;\n  if (target.matches(NAV_BTN_SELECTOR)) {\n    const { navigate } = target.dataset;\n    router.navigate(navigate);\n  }\n});\n","const getTemplate = () => {\n  const template = document.getElementById(\"template-header\");\n  return template.content.firstElementChild.cloneNode(true);\n};\n\nexport default (element) => {\n  const newElement = element.cloneNode(true);\n  newElement.innerHTML = \"\";\n  newElement.appendChild(getTemplate());\n\n  return newElement;\n};\n"],"names":["vdom","addComponent","name","component","removeComponent","root","undefined","querySelector","innerHTML","render","async","element","dispatch","redirect","console","log","cloneComponent","cloneNode","querySelectorAll","forEach","childNode","dataset","newChildNode","replaceWith","notfoundComponent","document","getElementById","newElement","appendChild","content","firstElementChild","getTemplate","attributes","index","tag","textContent","title","summary","date","slice","postsComponent","posts","map","post","node","addEventListener","e","$post","target","closest","id","getAttribute","ROUTE_PARAMETER_REGEXP","NOT_FOUND_POST","htmlBody","detailComponent","extractedPost","Number","detailElement","state","isPending","model","key","response","fetch","ok","Error","json","error","fetchPosts","router","routes","notFound","prevHash","checkRoutes","hash","window","location","currentRoute","find","route","testRegExp","test","urlParams","windowHash","params","length","matches","match","shift","paramValue","paramName","extractUrlParams","rootElement","requestAnimationFrame","newRootElement","renderDOM","addRoute","fragment","parsedFragment","replace","push","RegExp","setNotFound","cb","navigate","start","createRouter","args","path","body"],"mappings":"yBAEA,MAAMA,EAAO,CAAA,EACPC,EAAe,CAACC,EAAMC,KAC1BH,EAAKE,GAAQC,CAAS,EAElBC,EAAkB,CAACF,EAAMG,KAC3BL,EAAKE,QAAQI,EACXD,EAAKE,cAAc,oBAAoBL,SACzCG,EAAKE,cAAc,oBAAoBL,OAAUM,UAAY,GAC9D,EAGGC,EAASC,MAAOC,EAASC,EAAUC,EAAUX,KAC/CY,QAAQC,IAAIf,GACd,MAAMgB,EAAkBd,QAEdF,EAAKE,GAAMS,EAASC,EAAUC,GADpCF,EAAQM,WAAU,GAYtB,MARA,IAFwBD,EAAeE,iBAAiB,qBAEnCC,SAAQT,MAAOU,IAClC,MAAQjB,UAAWD,GAASkB,EAAUC,QACtC,QAAmBf,IAAfN,EAAKE,GAAqB,CAC5B,MAAMoB,QAAqBb,EAAOW,EAAWR,EAAUC,EAAUX,GACjEkB,EAAUG,YAAYD,EACvB,KAGIN,CAAc,ECvBvB,IAAAQ,EAAe,KACb,MAAMnB,EAAOoB,SAASC,eAAe,QAC/BC,EAAatB,EAAKE,cAAc,0BAA0BU,WAAU,GAC1EZ,EAAKE,cAAc,0BAA0BC,UAAY,GACzDH,EAAKE,cAAc,6BAA6BC,UAAY,GAC5DH,EAAKE,cAAc,4BAA4BC,UAAY,GAC3DmB,EAAWnB,UAAY,GACvBmB,EAAWC,YAXMH,SAASC,eAAe,gBACzBG,QAAQC,kBAAkBb,WAAU,IAYpDZ,EAAKE,cAAc,0BAA0BgB,YAAYI,EAAW,ECdtE,MAKMI,EAAc,EAAGC,cAAcC,KAEnC,MAAMtB,EANWc,SAASC,eAAe,iBACzBG,QAAQC,kBAAkBb,WAAU,GAiBpD,OAVAH,QAAQC,IAAIiB,GAEZA,EAAWE,IAAIf,SAAQe,IACrBvB,EAAQJ,cAAc,QAAQC,WAAa,iBAAiB0B,kBAAoB,IAGlFvB,EAAQJ,cAAc,SAASc,QAAQY,MAAQA,EAAQ,EACvDtB,EAAQJ,cAAc,UAAU4B,YAAcH,EAAWI,MACzDzB,EAAQJ,cAAc,YAAY4B,YAAcH,EAAWK,QAC3D1B,EAAQJ,cAAc,SAAS4B,YAAcH,EAAWM,KAAKC,MAAM,EAAG,IAC/D5B,CAAO,EAGhB,IAAA6B,EAAe9B,MAAOC,EAASC,EAAUC,KACvC,MAAM4B,QAAc7B,EAAS,SAEvBe,EAAahB,EAAQM,WAAU,GAgBrC,OAfEU,EAAWnB,UAAY,GACzBiC,EACGC,KAAI,CAACC,EAAMV,IAAUF,EAAYY,EAAMV,KACvCd,SAASyB,GAASjB,EAAWC,YAAYgB,KAG5CjB,EAAWkB,iBAAiB,SAAUC,IACpC,MAAMC,EAAQD,EAAEE,OAAOC,QAAQ,gBAE/B,GAAIF,EAAO,CACT,MAAMG,EAAKH,EAAMI,aAAa,cAC9BtC,EAAS,UAAUqC,IACpB,KAGIvB,CAAU,ECzCnB,MAAMyB,EAAyB,UCA/B,MAAMC,EAAiB,CACrBrB,WAAY,CACVI,MAAO,kBAETkB,SAAU,IAOZ,IAAAC,EAAe7C,MAAOwC,EAAIvC,EAASC,KACjC,MACM4C,SADc5C,EAAS,UACD6C,OAAOP,GAAM,IACnClB,WAAEA,EAAUsB,SAAEA,GAAaE,GAAiBH,EAG5CK,EAVWjC,SAASC,eAAe,mBACzBG,QAAQC,kBAAkBb,WAAU,GAUpDyC,EAAcnD,cAAc,kBAAkBC,UAAY8C,EAC1DI,EAAcnD,cAAc,UAAU4B,YAAcH,EAAWI,MAC/DsB,EAAcnD,cAAc,SAAS4B,YAAcH,EAAWM,MAAMC,MAClE,EACA,IAEF,MAAMZ,EAAahB,EAAQM,WAAU,GAGrC,OAFAU,EAAWnB,UAAY,GACvBmB,EAAWC,YAAY8B,GAChB/B,CAAU,EC3BnB,MAAMgC,EAAQ,CACZlB,MAAO,GACPmB,WAAW,GAqBE,IAAAC,EAAAnD,MAAOoD,IACpB,IAEE,QArBepD,WACjB,IACE,IAAKiD,EAAMC,UAAW,OACtB,MAAMG,QAAiBC,MAAM,qBAE7B,IAAKD,EAASE,GACZ,MAAM,IAAIC,MAAM,6BAGlB,MAAMzB,MAAEA,SAAgBsB,EAASI,OAEjCR,EAAMlB,MAAQA,EACdkB,EAAMC,WAAY,CACnB,CAAC,MAAOQ,GACPtD,QAAQsD,MAAM,4BAA6BA,EAC5C,GAKOC,QACa/D,IAAfqD,EAAMG,GACR,MAAM,IAAII,MAAM,iBAElB,OAAOP,EAAMG,EACd,CAAC,MAAOM,GACPtD,QAAQsD,MAAM,oBAAqBA,EACpC,GCbHnE,EAAa,OCdGU,IACd,MAAMgB,EAAahB,EAAQM,WAAU,GAIrC,OAHAU,EAAWnB,UAAY,GACvBmB,EAAWC,YAPMH,SAASC,eAAe,mBACzBG,QAAQC,kBAAkBb,WAAU,IAQ7CU,CAAU,IDWnB,MAAM2C,EHES,MACb,MAAMC,EAAS,GACf,IAAIC,EAAW,OACXC,EAAW,KACf,MAAMH,EAAS,CAAA,EAETI,EAAc,CAAC9D,EAAUC,KAC7B,MAAM8D,KAAEA,GAASC,OAAOC,SACxB,GAAIJ,IAAaE,EACf,OAGFF,EAAWE,EAEX,MAAMtE,EAAOoB,SAASC,eAAe,QAC/BoD,EAAeP,EAAOQ,MAAMC,IAChC,MAAMC,WAAEA,GAAeD,EACvB,OAAOC,EAAWC,KAAKP,EAAK,IAG9B,IAAKG,EAEH,YADAN,IAIF,MAAMW,EA5Ce,EAACH,EAAOI,KAC/B,MAAMC,EAAS,CAAA,EAEf,GAA4B,IAAxBL,EAAMK,OAAOC,OACf,OAAOD,EAGT,MAAME,EAAUH,EAAWI,MAAMR,EAAMC,YASvC,OAPAM,EAAQE,QAERF,EAAQpE,SAAQ,CAACuE,EAAYzD,KAC3B,MAAM0D,EAAYX,EAAMK,OAAOpD,GAC/BoD,EAAOM,GAAaD,CAAU,IAGzBL,CAAM,EA4BOO,CAAiBd,EAAcF,OAAOC,SAASF,MAEjEG,EAAa3E,UAAUE,EAAM8E,GHnBf,EAACU,EAAajF,EAAUC,KACtC+D,OAAOkB,uBAAsBpF,UAC5BI,QAAQC,IAAI,uBAAwB8E,GACpC,MAAME,QAAuBtF,EAAOoF,EAAajF,EAAUC,GAC3DC,QAAQC,IAAI,sCAAuCgF,GACpDF,EAAYtE,YAAYwE,EAAe,GACvC,EGgBAC,CAAU3F,EAAMO,EAAUC,EAAS,EA4CrC,OAxCAyD,EAAO2B,SAAW,CAACC,EAAU/F,KAC3B,MAAMkF,EAAS,GAETc,EAAiBD,EACpBE,QAAQhD,GAAwB,CAACoC,EAAOG,KACvCN,EAAOgB,KAAKV,GA7DQ,eAgErBS,QAAQ,MAAO,OAQlB,OANA7B,EAAO8B,KAAK,CACVpB,WAAY,IAAIqB,OAAO,IAAIH,MAC3BhG,YACAkF,WAGKf,CAAM,EAGfA,EAAOiC,YAAeC,IACpBhC,EAAWgC,EACJlC,GAGTA,EAAOmC,SAAYP,IACjBtB,OAAOC,SAASF,KAAOuB,CAAQ,EAGjC5B,EAAOoC,MAAQ,CAAC9F,EAAUC,KACxB+D,OAAO/B,iBAAiB,cAAc,KACpC/B,QAAQC,IAAI,kBACZ2D,EAAY9D,EAAUC,EAAS,IAE5B+D,OAAOC,SAASF,OACnBC,OAAOC,SAASF,KAAO,WAGzBD,EAAY9D,EAAUC,EAAS,EAG1ByD,CAAM,EG5EAqC,GACfrC,EACG2B,SAAS,WAAY5F,IACpBJ,EAAa,QAASuC,GACtBpC,EAAgB,SAAUC,GAC1BD,EAAgB,MAAOC,EAAK,IAE7B4F,SAAS,eAAe,CAAC5F,GAAQ6C,SAChCjD,EAAa,UAAU,IAAI2G,IAASrD,EAAgBL,KAAO0D,KAC3DxG,EAAgB,QAASC,GACzBD,EAAgB,MAAOC,EAAK,IAE7BkG,aAAY,KACX/E,GAAmB,IAEpBkF,OAvBchG,MAAOoD,SAAcD,EAAMC,KAE1B+C,IAChBjC,OAAOC,SAASF,KAAOkC,CAAI,IAuB7BpF,SAASqF,KAAKjE,iBAAiB,SAAUC,IACvC,MAAME,OAAEA,GAAWF,EACnB,GAAIE,EAAOuC,QAHY,sBAGe,CACpC,MAAMkB,SAAEA,GAAazD,EAAO3B,QAC5BiD,EAAOmC,SAASA,EACjB"}